<section class="employee-list">
    <header class="page-header">
      <div>
        <h1>社員一覧・検索</h1>
      </div>
      <div class="action-buttons">
        <button
        type="button"
        class="ghost"
        aria-label="外部データ連携を実行"
        (click)="syncExternalData()"
        [disabled]="isSyncingExternal"
      >
        {{ isSyncingExternal ? '外部データ連携中…' : '外部データ連携' }}
      </button>
        <button type="button" class="ghost" aria-label="CSVインポート画面へ" (click)="goToImport()">
          社員情報CSVインポート
        </button>
        <button type="button" class="primary" aria-label="新規社員登録画面へ" (click)="goToCreate()">
          新規社員登録
        </button>
      </div>
    </header>
  
    <section class="card integration-result" *ngIf="externalSyncResult || externalSyncError">
      <header>
        <div>
          <h2>外部データ連携の結果</h2>
          <p class="hint">エラーがある場合でも正常な行だけ取り込みます。</p>
        </div>
        <div class="status">
          <span class="status-badge" [class.status-active]="!externalSyncError" [class.status-terminated]="!!externalSyncError">
            {{ externalSyncError ? '一部エラー' : '完了' }}
          </span>
        </div>
      </header>

      <div *ngIf="externalSyncResult" class="result-grid">
        <div class="metric">
          <p class="label">受信件数</p>
          <p class="value">{{ externalSyncResult.total }} 件</p>
        </div>
        <div class="metric">
          <p class="label">取り込み済み</p>
          <p class="value">{{ externalSyncResult.processed }} 件</p>
        </div>
        <div class="metric">
          <p class="label">新規登録</p>
          <p class="value success">{{ externalSyncResult.created }} 件</p>
        </div>
        <div class="metric">
          <p class="label">更新</p>
          <p class="value info">{{ externalSyncResult.updated }} 件</p>
        </div>
      </div>

      <div *ngIf="externalSyncError" class="error-message">{{ externalSyncError }}</div>

      <div *ngIf="externalSyncResult?.errors?.length" class="error-list">
        <h3>取り込みエラー</h3>
        <ul>
          <li *ngFor="let error of externalSyncResult?.errors || []">
            <span class="error-number">#{{ error.index + 1 }}</span>
            <span class="error-body">
              <strong *ngIf="error.employeeNo">社員番号: {{ error.employeeNo }} / </strong>
              {{ error.message }}
            </span>
          </li>
        </ul>
      </div>
    </section>
    <section class="card search-card">
      <header>
        <div>
          <h2>社員情報検索</h2>
        </div>
        <div class="search-actions">
          <button type="button" class="ghost" (click)="clear()">クリア</button>
          <button type="button" class="primary" (click)="search()">検索</button>
        </div>
      </header>
  
      <div class="search-grid">
        <label class="field">
          <span>社員番号（完全一致）</span>
          <input
            type="text"
            name="employeeNo"
            placeholder="例：202501"
            [(ngModel)]="searchCondition.employeeNo"
          />
        </label>
        <label class="field">
          <span>氏名（部分一致）</span>
          <input
            type="text"
            name="name"
            placeholder="例：佐藤"
            [(ngModel)]="searchCondition.name"
          />
        </label>
        <label class="field">
          <span>所属部署</span>
          <select name="department" [(ngModel)]="searchCondition.department">
            <option value="">全て</option>
            <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
          </select>
        </label>
      </div>
    </section>
  
    <section class="card table-card">
      <header>
        <div>
        </div>
      </header>
  
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>社員番号</th>
              <th>氏名（漢字）</th>
              <th>生年月日</th>
              <th>所属部署</th>
              <th>勤務地都道府県</th>
              <th>標準報酬月額</th>
              <th class="actions-col">操作</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngIf="isLoading">
                <td colspan="7" class="empty">データを読み込み中です…</td>
              </tr>
            <tr
              *ngFor="let employee of paginatedEmployees; trackBy: trackByEmployee"
              (click)="onRowClick(employee)"
            >
              <td>{{ employee.employeeNo }}</td>
              <td>{{ employee.name }}</td>
              <td>{{ employee.birthDate | date: 'yyyy/MM/dd' }}</td>
              <td>{{ employee.department }}</td>
              <td>{{ employee.workPrefecture }}</td>
              <td class="numeric">{{ employee.standardMonthly | number: '1.0-0' }} 円</td>
              <td class="actions-col">
                <button type="button" class="ghost" (click)="onViewDetail($event, employee)">
                  詳細
                </button>
              </td>
            </tr>
            <tr *ngIf="!isLoading && !paginatedEmployees.length">
              <td colspan="7" class="empty">条件に合致する社員が見つかりませんでした。</td>
            </tr>
          </tbody>
        </table>
      </div>
  
      <footer class="table-footer">
        <div class="page-size">
          <label>
            表示件数
            <select [ngModel]="pageSize" (ngModelChange)="changePageSize($event)">
              <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}件</option>
            </select>
          </label>
          <span class="hint">{{ getPageRangeLabel() }}</span>
        </div>
        <div class="pager">
          <button type="button" class="ghost" (click)="prevPage()" [disabled]="currentPage === 1">
            前ページ
          </button>
          <span>{{ currentPage }} / {{ totalPages }} ページ</span>
          <button
            type="button"
            class="ghost"
            (click)="nextPage()"
            [disabled]="currentPage === totalPages || !totalCount"
          >
            次ページ
          </button>
        </div>
      </footer>
    </section>
  </section>