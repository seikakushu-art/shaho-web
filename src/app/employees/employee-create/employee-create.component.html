<section class="employee-create">
    <header class="page-header">
      <div>
        <h1>{{ isEditMode ? '社員編集' : '社員新規登録' }}</h1>
      </div>
      <div class="header-actions">
        <button type="button" class="outline" (click)="toggleEditMode()">
          {{ editMode ? '閲覧モードに切替' : '編集モードに切替' }}
        </button>
        <a routerLink="/employees" class="secondary ghost">一覧に戻る</a>
      </div>
    </header>
  
    <form #employeeForm="ngForm" novalidate>
      <article class="card">
        <div class="card-header">
          <div>
            <h2>基本情報</h2>
          </div>
          <p class="hint"> * は必須項目</p>
        </div>
  
        <div class="grid four-col">
          <div>
            <label>社員番号 *</label>
            <input
              name="employeeNo"
              [(ngModel)]="basicInfo.employeeNo"
              required
              [readonly]="!editMode"
              #employeeNoModel="ngModel"
            />
            <p class="error" *ngIf="employeeNoModel.invalid && (submitAttempted || employeeNoModel.touched)">
              社員番号は必須です。
            </p>
          </div>
          <div>
            <label>氏名 *</label>
            <input
              name="name"
              [(ngModel)]="basicInfo.name"
              required
              [readonly]="!editMode"
              #nameModel="ngModel"
            />
            <p class="error" *ngIf="nameModel.invalid && (submitAttempted || nameModel.touched)">
              氏名は必須です。
            </p>
          </div>
          <div>
            <label>氏名（カナ） *</label>
            <input
              name="kana"
              [(ngModel)]="basicInfo.kana"
              required
              [readonly]="!editMode"
              #kanaModel="ngModel"
            />
            <p class="error" *ngIf="kanaModel.invalid && (submitAttempted || kanaModel.touched)">
              カナは必須です。
            </p>
          </div>
          <div>
            <label>性別</label>
            <select name="gender" [(ngModel)]="basicInfo.gender" [disabled]="!editMode">
              <option value="">選択してください</option>
              <option value="男性">男性</option>
              <option value="女性">女性</option>
            </select>
          </div>
          <div>
            <label>生年月日 *</label>
            <input
              type="date"
              name="birthDate"
              [(ngModel)]="basicInfo.birthDate"
              required
              [readonly]="!editMode"
              #birthDateModel="ngModel"
            />
            <p class="error" *ngIf="birthDateModel.invalid && (submitAttempted || birthDateModel.touched)">
              生年月日は必須です。
            </p>
          </div>
          <div>
            <label>所属部署 *</label>
            <input
              name="department"
              [(ngModel)]="basicInfo.department"
              required
              [readonly]="!editMode"
              #deptModel="ngModel"
            />
            <p class="error" *ngIf="deptModel.invalid && (submitAttempted || deptModel.touched)">
              所属部署は必須です。
            </p>
          </div>
          <div>
            <label>勤務地都道府県</label>
            <input name="workPrefecture" [(ngModel)]="basicInfo.workPrefecture" [readonly]="!editMode" />
          </div>
          <div>
            <label>個人番号</label>
            <input name="myNumber" [(ngModel)]="basicInfo.myNumber" [readonly]="!editMode" />
          </div>
          <div>
            <label>基礎年金番号</label>
            <input name="basicPensionNumber" [(ngModel)]="basicInfo.basicPensionNumber" [readonly]="!editMode" />
          </div>
          <div>
            <label>住所</label>
            <input name="address" [(ngModel)]="basicInfo.address" [readonly]="!editMode" />
          </div>
        </div>
      </article>
  
      <article class="card">
        <div class="card-header">
          <div>
            <h2>社会保険情報</h2>
          </div>
        </div>
  
        <div class="grid three-col">
          <div>
            <label>標準報酬月額</label>
            <input
              type="number"
              name="standardMonthly"
              [(ngModel)]="socialInsurance.standardMonthly"
              [readonly]="!editMode"
            />
          </div>
          <div>
            <label>標準賞与額年度累計</label>
            <input
              type="number"
              name="healthCumulative"
              [(ngModel)]="socialInsurance.healthCumulative"
              [readonly]="!editMode"
            />
          </div>
          <div>
            <label>被保険者番号一健康保険</label>
            <input
              name="healthInsuredNumber"
              [(ngModel)]="socialInsurance.healthInsuredNumber"
              [readonly]="!editMode"
            />
          </div>
          <div>
            <label>被保険者番号一厚生年金</label>
            <input
              name="pensionInsuredNumber"
              [(ngModel)]="socialInsurance.pensionInsuredNumber"
              [readonly]="!editMode"
            />
          </div>
          <div>
            <label>介護保険第2号被保険者フラグ</label>
            <label class="switch">
              <input
                type="checkbox"
                [(ngModel)]="socialInsurance.careSecondInsured"
                name="careSecond"
                [disabled]="!editMode"
              />
              <span></span>
            </label>
          </div>
          <div>
            <label>健康保険 資格取得日 *</label>
            <input
              type="date"
              name="healthAcquisition"
              [(ngModel)]="socialInsurance.healthAcquisition"
              required
              [readonly]="!editMode"
              #healthModel="ngModel"
            />
            <p class="error" *ngIf="healthModel.invalid && (submitAttempted || healthModel.touched)">
              健康保険の資格取得日は必須です。
            </p>
          </div>
          <div>
            <label>厚生年金 資格取得日 *</label>
            <input
              type="date"
              name="pensionAcquisition"
              [(ngModel)]="socialInsurance.pensionAcquisition"
              required
              [readonly]="!editMode"
              #pensionModel="ngModel"
            />
            <p class="error" *ngIf="pensionModel.invalid && (submitAttempted || pensionModel.touched)">
              厚生年金の資格取得日は必須です。
            </p>
          </div>
          <div>
            <label>育休開始日</label>
            <input
              type="date"
              name="childcareLeaveStart"
              [(ngModel)]="socialInsurance.childcareLeaveStart"
              [readonly]="!editMode"
            />
          </div>
          <div>
            <label>育休終了日</label>
            <input
              type="date"
              name="childcareLeaveEnd"
              [(ngModel)]="socialInsurance.childcareLeaveEnd"
              [readonly]="!editMode"
            />
          </div>
          <div>
            <label>産休開始日</label>
            <input
              type="date"
              name="maternityLeaveStart"
              [(ngModel)]="socialInsurance.maternityLeaveStart"
              [readonly]="!editMode"
            />
          </div>
          <div>
            <label>産休終了日</label>
            <input
              type="date"
              name="maternityLeaveEnd"
              [(ngModel)]="socialInsurance.maternityLeaveEnd"
              [readonly]="!editMode"
            />
          </div>
          <div>
            <label>健康保険・厚生年金一時免除フラグ</label>
            <label class="switch">
              <input
                type="checkbox"
                name="exemption"
                [(ngModel)]="socialInsurance.exemption"
                [disabled]="!editMode"
              />
              <span></span>
            </label>
          </div>
        </div>
      </article>

      <div class="notice">
        <app-flow-selector
          [label]="'承認フロー選択（担当者/承認者/システム管理者のみ起票可）'"
          [selectedFlowId]="selectedFlowId"
          (flowSelected)="onFlowSelected($event)"
          (flowsUpdated)="onFlowsUpdated($event)"
        ></app-flow-selector>
        <p class="message" *ngIf="approvalMessage">{{ approvalMessage }}</p>
        <p class="hint" *ngIf="!approvalMessage">承認完了後に登録されます。</p>
      </div>
  
      <div class="action-bar">
        <button type="button" class="secondary" (click)="handleSaveDraft(employeeForm)">一時保存</button>
        <button type="button" class="primary" (click)="handleProceedApproval(employeeForm)">承認依頼へ進む</button>
        <a routerLink="/employees" class="outline ghost">キャンセル</a>
      </div>
    </form>
  </section>