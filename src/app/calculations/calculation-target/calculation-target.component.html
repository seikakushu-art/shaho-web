<header>
  <h1>{{ calculationTypes[calculationType] }}</h1>
</header>

<div class="form-grid">
  <div class="card">
    <div class="field">
      <label>計算種別</label>
      <div class="options">
        <label *ngFor="let type of calculationTypeOrder">
          <input
            type="radio"
            name="calcType"
            [value]="type"
            [checked]="calculationType === type"
            (change)="onCalculationTypeChange(type)"
          />
          {{ calculationTypes[type] }}
        </label>
      </div>
    </div>
    <div class="field">
      <label for="department">部署</label>
      <select id="department" [(ngModel)]="department">
        <option value="">すべて</option>
        <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
      </select>
    </div>
    <div class="field">
      <label for="location">勤務地</label>
      <select id="location" [(ngModel)]="location">
        <option value="">すべて</option>
        <option *ngFor="let loc of locations" [value]="loc">{{ loc }}</option>
      </select>
    </div>
    <div class="field">
      <label for="employeeNo">社員番号</label>
      <input id="employeeNo" type="text" [(ngModel)]="employeeNo" placeholder="例: E2025,E2026,E2027" />
    </div>
  </div>

  <div class="card">
    <div class="field">
      <label for="targetMonth" *ngIf="!isRegularDecision && !isBonusCalculation">対象年月</label>
      <label for="targetYear" *ngIf="isRegularDecision">対象年</label>
      <div style="display: flex; align-items: center; gap: 8px;">
      <input
        *ngIf="!isRegularDecision && !isBonusCalculation"
        id="targetMonth"
        type="month"
        [(ngModel)]="targetMonth"
      />
      <select
        *ngIf="isRegularDecision"
        id="targetYear"
        [(ngModel)]="targetYear"
      >
        <option *ngFor="let year of availableYears" [value]="year">{{ year }}年</option>
      </select>
        <span class="hint" *ngIf="isAdHocDecision" style="font-size: 0.85em; color: #666;">選択された月から3ヶ月の給与で標準報酬月額を計算する。</span>
        <span class="hint" *ngIf="isAnnualAverage" style="font-size: 0.85em; color: #666;">対象月を基準に、前年7月～当年6月の12か月の給料で計算します。</span>
        <span class="hint" *ngIf="isAcquisitionDecision" style="font-size: 0.85em; color: #666;">健康保険と厚生年金の資格取得日の月の給料で決めます。</span>
      </div>
    </div>
    <div class="field" *ngIf="isStandardCalculation">
      <label for="standardCalculationMethod">標準報酬月額の算定方法</label>
      <select id="standardCalculationMethod" [(ngModel)]="standardCalculationMethod">
        <option *ngFor="let method of standardCalculationMethods" [value]="method">{{ method }}</option>
      </select>
    </div>
    <div class="field" *ngIf="isBonusCalculation">
      <label for="bonusPaymentDate">賞与支給日</label>
      <div class="hint" style="font-size: 0.85em; color: #666;">ここは標準賞与額の試算欄です。実計算は社会保険料計算で行われます。</div>
      <input id="bonusPaymentDate" type="date" [(ngModel)]="bonusPaymentDate" />
    </div>
    <div class="field" *ngIf="calculationType === 'insurance'">
      <label>
        <input type="checkbox" [(ngModel)]="includeBonusInMonth" [disabled]="bonusOnly" (change)="onIncludeBonusInMonthChange()" />
        対象月に賞与を含める
      </label>
      <div class="hint" style="font-size: 0.85em; color: #666;">標準賞与額は自動計算されます。</div>
    </div>
    <div class="field" *ngIf="calculationType === 'insurance'">
      <label>
        <input type="checkbox" [(ngModel)]="bonusOnly" [disabled]="includeBonusInMonth" (change)="onBonusOnlyChange()" />
        賞与のみ計算
      </label>
      <div class="hint" style="font-size: 0.85em; color: #666;">同じ月に2回賞与が支給される場合は、2回分を合算してから標準賞与額を計算します。</div>
    </div>
    <div class="field">
      <label>保険種別</label>
      <div class="options">
        <label>
          <input type="checkbox" [checked]="insuranceSelections['health']" (change)="toggleInsurance('health')" [disabled]="isStandardCalculation || isBonusCalculation" />
          健康保険
        </label>
        <label>
          <input type="checkbox" [checked]="insuranceSelections['welfare']" (change)="toggleInsurance('welfare')" [disabled]="isStandardCalculation || isBonusCalculation" />
          厚生年金
        </label>
        <label>
          <input type="checkbox" [checked]="insuranceSelections['nursing']" (change)="toggleInsurance('nursing')" [disabled]="isStandardCalculation || isBonusCalculation" />
          介護保険
        </label>
      </div>
      <div class="hint" style="font-size: 0.85em; color: #666;" *ngIf="isStandardCalculation || isBonusCalculation">
        保険種別の選択は社会保険料計算でのみ利用できます。
      </div>
    </div>
    <div class="actions-row">
      <button type="button" class="primary" (click)="onSubmit()">この条件で計算結果を表示</button>
    </div>
  </div>
</div>
  
    <div class="card">
      <table class="preview-table">
        <thead>
          <tr>
            <th>社員番号</th>
            <th>氏名</th>
            <th>部署</th>
            <th>勤務地</th>
            <th *ngIf="isStandardCalculation || calculationType === 'insurance'">健保標準報酬月額</th>
            <th *ngIf="isStandardCalculation || calculationType === 'insurance'">厚年標準報酬月額</th>
            <th *ngIf="calculationType === 'insurance'">介護保険第2号被保険者フラグ</th>
            <th *ngIf="isBonusCalculation">最新の賞与支給日</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let candidate of filteredCandidates">
            <td>{{ candidate.employeeNo }}</td>
            <td>{{ candidate.name }}</td>
            <td>{{ candidate.department }}</td>
            <td>{{ getCandidateLocation(candidate) }}</td>
            <td *ngIf="isStandardCalculation || calculationType === 'insurance'">
              {{ candidate.healthStandardMonthly ? (candidate.healthStandardMonthly | number: '1.0-0') + ' 円' : '未設定' }}
            </td>
            <td *ngIf="isStandardCalculation || calculationType === 'insurance'">
              {{ candidate.welfareStandardMonthly ? (candidate.welfareStandardMonthly | number: '1.0-0') + ' 円' : '未設定' }}
            </td>
            <td *ngIf="calculationType === 'insurance'">
              {{ candidate.careSecondInsured !== undefined ? (candidate.careSecondInsured ? 'ON' : 'OFF') : '未設定' }}
            </td>
            <td *ngIf="isBonusCalculation">{{ getCandidateBonusDate(candidate) || '未登録' }}</td>
          </tr>
        </tbody>
      </table>
    </div>