<section class="calculation-menu">
    <header>
      <h1>標準報酬月額 / 標準賞与額 / 社会保険料計算</h1>
    </header>
  
    <div class="menu-grid">
      <article class="menu-card" *ngFor="let item of items">
        <header>
          <h2>{{ item.title }}</h2>
          <p class="hint">{{ item.description }}</p>
        </header>
        <div class="actions-row">
          <a
            routerLink="/calculations/target"
            [queryParams]="{ type: item.key }"
            class="text-link"
            >対象を選択する</a
          >
        </div>
      </article>
    </div>

    <div class="card history-card" *ngIf="historyEntries.length">
      <div class="history-header">
        <div>
          <h2>承認された計算結果 <span class="hint">承認後の計算結果は社員情報に反映されます。</span></h2>
        </div>
        <span class="history-count">{{ historyEntries.length }}件</span>
      </div>
      <div class="history-list">
        <button
          type="button"
          class="history-item"
          *ngFor="let history of historyEntries"
          (click)="goToHistory(history)"
        >
          <div class="history-title-row">
            <span class="history-title">{{ history.title }}</span>
            <span class="history-date">{{
              history.createdAt | date: 'yyyy/MM/dd HH:mm'
            }}</span>
          </div>
          <div class="history-meta">
            <span>{{ calculationTypes[history.query.type] }}</span>
            <span>{{ getHistoryTargetLabel(history) }}: {{ getHistoryTargetDisplay(history) }}</span>
            <span *ngIf="history.query.type === 'standard'">
              標準報酬月額の算定方法: {{ history.query.standardMethod }}
            </span>
            <span *ngIf="history.query.type === 'insurance' && history.query.includeBonusInMonth === true">
              対象月に賞与を含める
            </span>
            <span *ngIf="history.query.type === 'insurance' && history.query.bonusOnly === true">
              賞与のみ
            </span>
            <span>
              保険:
              {{
                history.meta?.activeInsurances?.join(' / ')
                  || history.query.insurances.join(' / ')
              }}
            </span>
            <span>件数: {{ history.meta?.rowCount ?? history.rows.length }}</span>
          </div>
        </button>
      </div>
    </div>
  </section>