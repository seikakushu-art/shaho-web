<section class="approval-list">
    <header class="page-header">
      <div>
        <h1>承認/申請一覧</h1>
      </div>
      <p class="hint">最新の申請から表示しています。</p>
    </header>
  
    <section class="card filter-card">
      <div class="filter-row">
        <div class="filter-group">
          <label for="flow-filter">承認フロー</label>
          <select id="flow-filter" [(ngModel)]="selectedFlowId" class="filter-select">
            <option [ngValue]="null">すべて</option>
            <option *ngFor="let flow of flows$ | async" [ngValue]="flow.id">{{ flow.name }}</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="category-filter">区分</label>
          <select id="category-filter" [(ngModel)]="selectedCategory" class="filter-select">
            <option [ngValue]="null">すべて</option>
            <option *ngFor="let category of categories" [ngValue]="category">{{ category }}</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="applicant-filter">申請者</label>
          <select id="applicant-filter" [(ngModel)]="selectedApplicantId" class="filter-select">
            <option [ngValue]="null">すべて</option>
            <option *ngFor="let applicant of applicants$ | async" [ngValue]="applicant.id">{{ applicant.displayName }}</option>
          </select>
        </div>
        <div class="filter-group filter-toggle">
          <label class="checkbox-label">
            <input
              id="my-application-only"
              type="checkbox"
              [(ngModel)]="showOnlyMyApplications"
            />
            <span>自分の申請のみ表示</span>
          </label>
          <label class="checkbox-label" *ngIf="canApprove$ | async">
            <input
              id="my-task-only"
              type="checkbox"
              [(ngModel)]="showOnlyMyTasks"
            />
            <span>自分の承認依頼のみ表示</span>
          </label>
        </div>
        <button type="button" class="clear-filters-btn" (click)="clearFilters()">フィルターをクリア</button>
      </div>
    </section>

    <section class="card table-card">
  
      <div class="table-wrapper" *ngIf="approvals$ | async as approvals">
        <table>
          <thead>
            <tr>
              <th>承認フロー</th>
              <th>区分</th>
              <th>対象社員件数</th>
              <th>申請者</th>
              <th>申請日時</th>
              <th>現在の承認ステップ</th>
              <th>ステータス</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let approval of approvals" (click)="onRowClick(approval)">
              <td class="id-cell">
                <div class="id-cell__label">
                  <span class="flow-name">{{ approval.flowSnapshot?.name || '-' }}</span>
                </div>
              </td>
              <td>
                <span class="badge" [class]="categoryClass(approval.category)">{{ approval.category }}</span>
              </td>
              <td class="numeric">
                <ng-container *ngIf="approval.category !== '保険料率更新' && approval.category !== '法人情報更新'">
                  {{ approval.targetCount }} 件
                </ng-container>
              </td>
              <td>{{ approval.applicantDisplayName }}</td>
              <td>{{ getTimestampDate(approval.createdAt) | date: 'yyyy/MM/dd HH:mm' }}</td>
              <td class="numeric">{{ approval.currentStep || '-' }}</td>
              <td>
                <span class="status" [class]="statusClass(approval.status)">{{ statusLabel(approval.status) }}</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </section>