<section class="dashboard">
    <header>
      <div>
        <h1>社会保険管理システム</h1>
        <p class="greeting" *ngIf="(appUser$ | async) as appUser; else notLoggedIn">こんにちは、{{ appUser?.displayName }} さん</p>
        <ng-template #notLoggedIn>
          <p class="greeting">ログインしてください。</p>
        </ng-template>
      </div>
      <div class="header-actions">
      </div>
    </header>

    <section class="card" *ngIf="(allNotifications$ | async) as allNotifications">
      <header class="section-header">
        <div>
          <h2>通知</h2>
        </div>
      </header>

      <ul class="notifications">
        <li 
          *ngFor="let notification of (notificationsExpanded ? allNotifications : allNotifications.slice(0, 5)); trackBy: trackByNotificationId" 
          [ngClass]="{ 'notification-unread': notification.unread, 'notification-clickable': notification.unread }"
        >
          <div class="notification-body" (click)="notification.unread && markNotificationAsRead(notification.id, $event)">
            <p class="eyebrow">{{ notification.createdAt | date: 'MM/dd HH:mm' }}</p>
            <p class="hint">
              <span *ngIf="notification.unread" class="unread-icon" aria-hidden="true">&#9888;</span>
              {{ notification.message }}
            </p>
          </div>
          <div class="notification-actions">
            <a 
              *ngIf="notification.requestId" 
              [routerLink]="['/approvals', notification.requestId]" 
              class="notification-link"
              (click)="$event.stopPropagation()"
            >
              詳細
            </a>
            <button
              *ngIf="notification.unread"
              class="mark-read-button"
              (click)="markNotificationAsRead(notification.id, $event)"
              title="既読にする"
            >
              既読にする
            </button>
            <span class="status" [ngClass]="notification.unread ? 'status-unread' : 'status-approved'">
              {{ notification.unread ? '未読' : '既読' }}
            </span>
          </div>
        </li>
      </ul>

      <div class="notification-footer" *ngIf="allNotifications.length > 5">
        <button 
          class="text-link notification-toggle" 
          (click)="toggleNotificationsExpanded()"
        >
          {{ notificationsExpanded ? '折りたたむ' : ('すべて表示（全' + allNotifications.length + '件）') }}
        </button>
      </div>
    </section>

    <section class="card" *ngIf="(appUser$ | async)">
      <h2>ワークスペース</h2>
      <div class="shortcut-grid">
        <a routerLink="/approval-flows" class="shortcut-card" *ngIf="(isSystemAdmin$ | async)">
          <h3>承認フロー管理</h3>
          <p class="hint">承認フローの作成・編集・管理</p>
        </a>
        <a routerLink="/user-management" class="shortcut-card" *ngIf="(isSystemAdmin$ | async)">
          <h3>ユーザー管理</h3>
          <p class="hint">ロール付与・凍結などアカウント管理</p>
        </a>
        <a routerLink="/corporate-info" class="shortcut-card">
          <h3>法人情報</h3>
          <p class="hint">事業所情報・適用事業所をメンテナンス</p>
        </a>
        <a routerLink="/insurance-rates" class="shortcut-card">
          <h3>保険料率</h3>
          <p class="hint">健保・厚年の料率設定を更新</p>
        </a>
        <a routerLink="/calculations" class="shortcut-card" *ngIf="!(isGuest$ | async)">
          <h3>計算機能</h3>
          <p class="hint">標準報酬月額、標準賞与額、社会保険料の計算を行います</p>
        </a>
      </div>
    </section>