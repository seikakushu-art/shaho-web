<section class="login-panel">
    <header>
      <h1>ログイン</h1>
    </header>
  
    <p class="message info" *ngIf="infoMessage">{{ infoMessage }}</p>
    <p class="message error" *ngIf="errorMessage">{{ errorMessage }}</p>
  
    <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="form-card">
      <label>
        メールアドレス
        <input type="email" formControlName="email" placeholder="user@example.com" />
      </label>
  
      <label>
        パスワード
        <div class="password-input-wrapper">
          <input [type]="showPassword ? 'text' : 'password'" formControlName="password" placeholder="6文字以上" />
          <button type="button" class="password-toggle" (click)="togglePasswordVisibility()" tabindex="-1">
            <span *ngIf="showPassword">非表示</span>
            <span *ngIf="!showPassword">表示</span>
          </button>
        </div>
      </label>
  
      <button type="submit" [disabled]="loginForm.invalid">ログイン</button>
    </form>
  
    <section class="form-card">
      <div style="display: flex; align-items: baseline; gap: 0.5rem;">
        <h2>パスワード変更</h2>
        <p class="hint" style="font-size: 0.875rem; color: #666; margin: 0;" *ngIf="!(user$ | async)">メールアドレスを入力して、パスワード変更できます。</p>
      </div>
      <ng-container *ngIf="(user$ | async) as user; else notLoggedIn">
        <p class="hint">
          ログイン中のユーザー宛にパスワード再設定メールを送信します。
          <span class="chip">送信先: {{ user.email }}</span>
        </p>
        <div class="inline">
          <button type="button" (click)="onPasswordChange()">パスワード再設定メールを送る</button>
        </div>
      </ng-container>
      <ng-template #notLoggedIn>
          <input type="email" [(ngModel)]="passwordResetEmail" placeholder="user@example.com" />
        <div class="inline">
          <button type="button" (click)="onPasswordChange()" [disabled]="!passwordResetEmail.trim()">パスワード再設定メールを送る</button>
        </div>
      </ng-template>
    </section>
  </section>